@model SIRH.Web.ViewModels.FormularioGastoTransporteVM
@{
    ViewBag.Title = "CreatePagoGastoTransporte";
    Layout = "~/Views/Shared/GastoTransporte.cshtml";
}
<link href="~/Content/datetimepicker.css" rel="stylesheet" />

<center><h2>Pago de Gasto de Transporte</h2></center>
@{
    Html.EnableClientValidation();
    using (Html.BeginForm(Ajax.BeginForm("CreatePagoGastoTransporte", "ViaticoCorrido", new AjaxOptions
    {
        UpdateTargetId = "dvResultadoBusqueda",
        HttpMethod = "POST",
        OnSuccess = "SuccessCargarFuncionario",
        OnComplete = "CompleteCargarFuncionario",
        OnBegin = "BeginCargarFuncionario"
    })))
    {
        <!-- Datos Personales -->
        <div id="tabs">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a id="tab1" class="nav-link " href="#tabs-1" data-toggle="tab" role="tab" aria-controls="tabs-1" aria-selected="true">Datos Funcionario</a>
                </li>
                <li class="nav-item">
                    <a id="tab2" class="nav-link active" href="#tabs-2" data-toggle="tab" role="tab" aria-controls="tabs-2" aria-selected="false">Datos Gasto Transporte</a>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <div id="tabs-1" class="tab-pane fade" role="tabpanel" aria-labelledby="tab1">
                    <table class="table table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th colspan="6">Información del Funcionario</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Nombre y puesto -->
                            <tr>
                                <td><b>@Html.LabelFor(model => model.Funcionario.Cedula)</b></td>
                                <td>
                                    @Html.DisplayFor(model => model.Funcionario.Cedula)
                                    @Html.HiddenFor(model => model.Funcionario.Cedula)
                                <td><b>@Html.LabelFor(model => model.Funcionario.Nombre)</b></td>
                                <td>
                                    @Model.Funcionario.Nombre @Model.Funcionario.PrimerApellido @Model.Funcionario.SegundoApellido
                                    @Html.HiddenFor(model => model.Funcionario.Nombre)
                                    @Html.HiddenFor(model => model.Funcionario.PrimerApellido)
                                    @Html.HiddenFor(model => model.Funcionario.SegundoApellido)
                                </td>
                                <td><b>@Html.LabelFor(model => model.Puesto.CodPuesto)</b></td>
                                <td>
                                    @Html.DisplayFor(model => model.Puesto.CodPuesto)
                                    @Html.HiddenFor(model => model.Puesto.CodPuesto)
                                </td>
                            </tr>
                            <!-- Especialidad y ocup. real -->
                            <tr>
                                <td><b>@Html.LabelFor(model => model.DetallePuesto.Especialidad.DesEspecialidad)</b></td>
                                <td>
                                    @Html.DisplayFor(model => model.DetallePuesto.Especialidad.DesEspecialidad)
                                    @Html.HiddenFor(model => model.DetallePuesto.Especialidad.DesEspecialidad)
                                </td>
                                <td><b>@Html.LabelFor(model => model.DetallePuesto.OcupacionReal.DesOcupacionReal)</b></td>
                                <td>
                                    @Html.DisplayFor(model => model.DetallePuesto.OcupacionReal.DesOcupacionReal)
                                    @Html.HiddenFor(model => model.DetallePuesto.OcupacionReal.DesOcupacionReal)
                                </td>
                            </tr>
                            <!-- Ubic. Administrativa -->
                            <tr>
                                <td><b>@Html.LabelFor(model => model.Puesto.UbicacionAdministrativa.Division.NomDivision)</b></td>
                                <td>
                                    @Html.DisplayFor(model => model.Puesto.UbicacionAdministrativa.Division.NomDivision)
                                    @Html.HiddenFor(model => model.Puesto.UbicacionAdministrativa.Division.NomDivision)
                                </td>
                                <td><b>@Html.LabelFor(model => model.Puesto.UbicacionAdministrativa.DireccionGeneral.NomDireccion)</b></td>
                                <td>
                                    @Html.DisplayFor(model => model.Puesto.UbicacionAdministrativa.DireccionGeneral.NomDireccion)
                                    @Html.HiddenFor(model => model.Puesto.UbicacionAdministrativa.DireccionGeneral.NomDireccion)
                                </td>
                                <td><b>@Html.LabelFor(model => model.Puesto.UbicacionAdministrativa.Departamento.NomDepartamento)</b></td>
                                <td>
                                    @Html.DisplayFor(model => model.Puesto.UbicacionAdministrativa.Departamento.NomDepartamento)
                                    @Html.HiddenFor(model => model.Puesto.UbicacionAdministrativa.Departamento.NomDepartamento)
                                </td>
                            </tr>
                            <!-- Cod Presupuesto -->
                            <tr>
                                <td><b>@Html.LabelFor(model => model.Puesto.UbicacionAdministrativa.Presupuesto.CodigoPresupuesto)</b></td>
                                <td>
                                    @Html.DisplayFor(model => model.Puesto.UbicacionAdministrativa.Presupuesto.CodigoPresupuesto)
                                    @Html.HiddenFor(model => model.Puesto.UbicacionAdministrativa.Presupuesto.CodigoPresupuesto)
                                </td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Lugar de Trabajo -->
                    <table class="table table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th colspan="6">Lugar de Trabajo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><b>@Html.LabelFor(model => model.UbicacionTrabajo.Distrito.Canton.Provincia)</b></td>
                                <td>
                                    @Model.UbicacionTrabajo.Distrito.Canton.Provincia.NomProvincia
                                <td><b>@Html.LabelFor(model => model.UbicacionTrabajo.Distrito.Canton)</b></td>
                                <td>
                                    @Model.UbicacionTrabajo.Distrito.Canton.NomCanton
                                </td>
                                <td><b>@Html.LabelFor(model => model.UbicacionTrabajo.Distrito)</b></td>
                                <td>
                                    @Model.UbicacionTrabajo.Distrito.NomDistrito
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Lugar de Contrato -->
                    <table class="table table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th colspan="6">Lugar de Contrato</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><b>@Html.LabelFor(model => model.UbicacionTrabajo.Distrito.Canton.Provincia)</b></td>
                                <td>
                                    @Model.UbicacionContrato.Distrito.Canton.Provincia.NomProvincia
                                <td><b>@Html.LabelFor(model => model.UbicacionTrabajo.Distrito.Canton)</b></td>
                                <td>
                                    @Model.UbicacionContrato.Distrito.Canton.NomCanton
                                </td>
                                <td><b>@Html.LabelFor(model => model.UbicacionTrabajo.Distrito)</b></td>
                                <td>
                                    @Model.UbicacionContrato.Distrito.NomDistrito
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Detalles del Domicilio -->
                    <table class="table table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th colspan="7">Detalles del Domicilio</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><b>@Html.LabelFor(model => model.UbicacionTrabajo.Distrito.Canton.Provincia)</b></td>
                                <td>
                                    @Model.Direccion.Distrito.Canton.Provincia.NomProvincia
                                <td><b>@Html.LabelFor(model => model.UbicacionTrabajo.Distrito.Canton)</b></td>
                                <td>
                                    @Model.Direccion.Distrito.Canton.NomCanton
                                </td>
                                <td><b>@Html.LabelFor(model => model.UbicacionTrabajo.Distrito)</b></td>
                                <td>
                                    @Model.Direccion.Distrito.NomDistrito
                                </td>
                                <td>@Model.Direccion.DirExacta</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Detalle del Gasto -->
                <div id="tabs-2" class="tab-pane fade show active" role="tabpanel" aria-labelledby="tab2">
                    <table class="table table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th colspan="6">Detalle del Gasto de Transporte</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><b>@Html.Label("Fecha Inicio")</b></td>
                                <td>
                                    @Model.GastoTransporte.FecInicioDTO.ToShortDateString()
                                    <input id='fechaVCFin' class="form-control text-center" disabled value=@String.Format("{0:n}", Model.GastoTransporte.FecInicioDTO.ToString("dd/MM/yyy")) hidden="hidden" />
                                <td><b>@Html.Label("Fecha Fin")</b></td>
                                <td>
                                    @Model.GastoTransporte.FecFinDTO.ToShortDateString()
                                    <input id='fechaVCFin' class="form-control text-center" disabled value=@String.Format("{0:n}", Model.GastoTransporte.FecFinDTO.ToString("dd/MM/yyy")) hidden="hidden" />
                                </td>
                                <td><b>@Html.Label("Monto")</b></td>
                                <td>
                                    @Convert.ToDecimal(Model.GastoTransporte.MontGastoTransporteDTO).ToString("#,##0.00")
                                    @Html.TextBoxFor(model => model.GastoTransporte.MontGastoTransporteDTO, new { @id = "Monto", @class = "form-control", @readonly = "readonly", @hidden = "hidden" })
                                    @* <input id='montoVC' class="form-control text-xl-right" disabled value=@String.Format("{0:n}", Convert.ToDecimal(Model.ViaticoCorrido.MontViaticoCorridoDTO).ToString("#,##0.00")) hidden="hidden"/>*@
                                </td>
                            </tr>
                            <tr>
                                <td><b>@Html.Label("Estado")</b></td>
                                <td>@Model.GastoTransporte.EstadoGastoTransporteDTO.NomEstadoDTO</td>
                                <td><b>@Html.Label("Tipo Nombramiento")</b></td>
                                <td>
                                    @Model.Nombramiento.EstadoNombramiento.DesEstado
                                    @if (Model.Nombramiento.EstadoNombramiento.DesEstado == "Propiedad")
                                    {
                                        <b hidden>@Model.Nombramiento.EstadoNombramiento.IdEntidad</b>
                                        @Html.ValidationMessageFor(model => model.Nombramiento.EstadoNombramiento.IdEntidad)
                                        @Html.ValidationMessageFor(model => model.Nombramiento.EstadoNombramiento.DesEstado)
                                        @Html.HiddenFor(model => model.Nombramiento.EstadoNombramiento.IdEntidad)
                                        @Html.HiddenFor(model => model.Nombramiento.EstadoNombramiento.DesEstado)
                                        @Html.HiddenFor(model => model.Nombramiento.EstadoNombramiento.DesEstado, new { @id = "EstadoN" })
                                        @Html.HiddenFor(model => model.Nombramiento.IdEntidad, new { @id = "FecVenceNom", @class = "form-control start_date", @readonly = "readonly", @placeholder = "Fecha de Finalización", @value = @Model.Nombramiento.IdEntidad })
                                    }
                                    else if (Model.Nombramiento.EstadoNombramiento.DesEstado == "Interino")
                                    {
                                        <label>Rige Desde</label>
                                        <b>@Model.Nombramiento.FecRige.ToShortDateString()</b>
                                        <label>Hasta</label>
                                        <b>@Model.Nombramiento.FecVence.ToShortDateString()</b>
                                    }
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><b>@Html.Label("Observaciones")</b></td>
                                <td>
                                    @Model.GastoTransporte.ObsGastoTransporteDTO
                                    @Html.HiddenFor(model => model.GastoTransporte.ObsGastoTransporteDTO)
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="jumbotron">
            <!-- Formulario de Gasto Transporte -->
            <div id="Div1">
                <div id="setForm">
                    <!--Se mantienen los datos para no volver a hacer la busqueda-->
                    @Html.TextBoxFor(model => model.Funcionario.Cedula, new { @id = "NumCedula", @class = "form-control", @readonly = "readonly", @hidden = "hidden" })
                    @Html.TextBoxFor(model => model.GastoTransporte.IdEntidad, new { @id = "idGasto", @class = "form-control", @disabled = "disabled", @hidden = "hidden" })
                    @Html.HiddenFor(model => model.Funcionario.Cedula)
                    @Html.HiddenFor(model => model.Funcionario.PrimerApellido)
                    @Html.HiddenFor(model => model.Funcionario.SegundoApellido)
                    @Html.HiddenFor(model => model.Funcionario.Nombre)
                    @Html.HiddenFor(model => model.UbicacionTrabajo.Distrito.Canton.Provincia.NomProvincia)
                    @Html.HiddenFor(model => model.UbicacionTrabajo.Distrito.Canton.NomCanton)
                    @Html.HiddenFor(model => model.UbicacionTrabajo.Distrito.NomDistrito)
                    @Html.HiddenFor(model => model.UbicacionContrato.Distrito.Canton.Provincia.NomProvincia)
                    @Html.HiddenFor(model => model.UbicacionContrato.Distrito.Canton.NomCanton)
                    @Html.HiddenFor(model => model.UbicacionContrato.Distrito.NomDistrito)
                    @Html.HiddenFor(model => model.Puesto.UbicacionAdministrativa.Division.NomDivision)
                    @Html.HiddenFor(model => model.Puesto.UbicacionAdministrativa.DireccionGeneral.NomDireccion)
                    @Html.HiddenFor(model => model.Puesto.UbicacionAdministrativa.Departamento.NomDepartamento)
                    @Html.HiddenFor(model => model.Puesto.CodPuesto)
                    @Html.HiddenFor(model => model.DetallePuesto.Clase.DesClase)
                    @Html.HiddenFor(model => model.DetallePuesto.Especialidad.DesEspecialidad)
                    @Html.HiddenFor(model => model.DetallePuesto.OcupacionReal.DesOcupacionReal)
                    @Html.HiddenFor(model => model.GastoTransporte.IdEntidad)
                    @Html.HiddenFor(model => model.GastoTransporte.MonPagoDTO)
                    @Html.HiddenFor(model => model.GastoTransporte.CodigoGastoTransporte)
                    @Html.HiddenFor(model => model.GastoTransporte.NombramientoDTO)
                    @Html.ValidationMessageFor(model => model.DistritoSeleccion)
                    @Html.ValidationMessageFor(model => model.Nombramiento.IdEntidad)
                    @Html.ValidationMessageFor(model => model.Nombramiento.FecRige)
                    @Html.ValidationMessageFor(model => model.Nombramiento.FecVence)
                    @Html.ValidationMessageFor(model => model.Nombramiento.EstadoNombramiento.IdEntidad)
                    @Html.ValidationMessageFor(model => model.Nombramiento.EstadoNombramiento.DesEstado)
                    @Html.ValidationMessageFor(model => model.Direccion.Distrito.IdEntidad)
                    @Html.ValidationMessageFor(model => model.Direccion.Distrito.NomDistrito)
                    @Html.HiddenFor(model => model.Direccion.Distrito.IdEntidad)
                    @Html.HiddenFor(model => model.Direccion.Distrito.NomDistrito)

                    <div class="card" style="margin-bottom:20px;">
                        <h5 class="card-header">Detalle Pago</h5>
                        <div class="row">
                            <div class="col-2"> </div>
                            <div class="col-2">
                                <b><label> Para el mes de: </label></b>
                            </div>
                            <div class="col-2">
                                @Html.DropDownListFor(model => model.MesSeleccion, Model.MesesGasto, "Meses", new { @id = "mesDeduccion", @onchange = "ObtenerDiasRebajo('Gasto')", @class = "btn btn-secondary dropdown-toggle", style = "width: 320px;" })
                                @Html.HiddenFor(model => model.GastoTransporte.FecPagoDTO)
                            </div>
                        </div>
                        <div class="card-body">
                            <center>
                                <!--Tabla Días de Deducción-->
                                <table class="table" id="tablaDias" style="margin-bottom:70px;">
                                    <thead class="table-active">
                                    </thead>
                                </table>
                                <table class="table" id="tablaDiasReintegro" style="margin-bottom:70px;">
                                    <thead class="table-active">
                                    </thead>
                                </table>
                                <table class="table" id="tablaTotalPago" style="margin-bottom:70px;">
                                    <thead class="table-active">
                                    </thead>
                                    <tbody>
                                        <tr class="text-left">
                                            <td><b>Total Pago Gasto</b></td>
                                            <td id="totalMA"><b>@Html.Encode(Model.TotalMA.ToString("#,##0.00"))</b></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </center>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            @* Button Regresar *@
                            <a href="javascript:history.back()" class="btn btn-secondary"><i class="fa fa-arrow-circle-left"></i> Regresar</a>
                            @* Button Guardar *@
                            <input class="btn btn-info" id="btnGuardar" name="SubmitButton" type="submit" value=" Registrar Pago " style="float:right;" @*onclick="agregarFacturasContratos()"*@ />
                        </div>
                        <div class="col-8">
                            <div id="preloader1" class="loader" hidden></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    }
    <div id="dvResultadoBusqueda"></div>
}

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")

<script src="~/Scripts/sidebar.js" type="text/javascript"></script>
<script src="~/scripts/jquery.unobtrusive-ajax.js" type="text/javascript"></script>
<script src="~/Scripts/Pages/FormularioGastoTransporte.js" type="text/javascript"></script>
<script src="~/Scripts/datetimepicker.js" type="text/javascript"></script>
<script src="~/Scripts/datetimepicker-es.js" type="text/javascript"></script>
<script type="text/javaScript">
    BeginCargarFuncionario();
</script>